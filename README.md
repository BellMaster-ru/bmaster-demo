# BMaster demo

Этот репозиторий содержит только демо: настоящий бэкенд не поддерживается.  
Все вызовы `/api/*` и вебсокеты `/api/queries/stream` эмулируются в браузере.

## Запуск

```bash
npm run dev
```

## Логин в демо

В демо доступен только сервисный режим

- Пароль: `bmaster`

## Хранение данных

- Моковое состояние (аккаунты, школа, настройки, метаданные): `localStorage`
- Звуковые файлы: `IndexedDB`

Процессы времени выполнения (активное воспроизведение / сессии стриминга / таймеры) сбрасываются при перезагрузке страницы.

## Упрощённый планировщик

- В режиме демо встроенный планировщик проверяет школьные назначения каждую секунду.
- Он ставит в очередь звуки начала/конца уроков из активного расписания для текущего дня недели.
- Учитывает:
  - `school/overrides` (`mute_all_lessons`, `mute_lessons`)
  - глобальное включение `lite/bells` + переключатели по дням недели
  - отключение отдельных уроков в `lite/bells/lessons`

## Сброс демо-состояния

На странице настроек:

- Нажмите кнопку `Сбросить демо-данные`.

Или в консоли браузера:

```js
await window.__bmasterMock?.reset();
```

Это сбросит исходные данные, очистит звуковые blob'ы и удалит токен авторизации.

## Поддерживаемые демо-сценарии

- Вход (режим сервиса и режим оператора)
- ICOM-запросы и действия микшера
- Загрузка/предпрослушивание/воспроизведение звуков
- Поток объявлений (моковый WebSocket)
- Взаимодействия с расписаниями/назначениями/переопределениями школы
- Действия в настройках (громкость, симуляция процесса обновления, команда перезагрузки, сброс демо-состояния)
